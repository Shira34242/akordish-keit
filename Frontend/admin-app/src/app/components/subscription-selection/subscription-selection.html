<div class="subscription-selection">
  <div class="header">
    <h1>בחר את התוכנית המתאימה לך</h1>
    <p class="subtitle">שדרג את הפרופיל שלך ותהנה מנראות מקסימלית</p>
  </div>

  <!-- Billing Cycle Toggle -->
  <div class="billing-toggle">
    <button
      [class.active]="billingCycle === 'Monthly'"
      (click)="billingCycle = 'Monthly'">
      חודשי
    </button>
    <button
      [class.active]="billingCycle === 'Yearly'"
      (click)="billingCycle = 'Yearly'">
      שנתי
      <span class="savings-badge" *ngIf="billingCycle === 'Yearly'">{{ getSavingsText() }}</span>
    </button>
  </div>

  <!-- Plans Grid -->
  <div class="plans-grid">
    <div
      *ngFor="let option of planOptions"
      class="plan-card"
      [class.selected]="selectedPlan === option.plan"
      [class.recommended]="option.recommended"
      (click)="selectPlan(option.plan)">

      <!-- Recommended Badge -->
      <div class="recommended-badge" *ngIf="option.recommended">
        מומלץ ביותר
      </div>

      <!-- Plan Header -->
      <div class="plan-header">
        <h3>{{ option.name }}</h3>
        <div class="price">
          <span class="amount">{{ getPlanPrice(option.plan) }}</span>
          <span class="currency">₪</span>
          <span class="period" *ngIf="option.plan !== 0">/{{ billingCycle === 'Monthly' ? 'חודש' : 'שנה' }}</span>
        </div>
        <div class="profiles-included" *ngIf="option.includedProfiles > 0">
          {{ option.includedProfiles }} {{ option.includedProfiles === 1 ? 'פרופיל כלול' : 'פרופילים כלולים' }}
        </div>
      </div>

      <!-- Features List -->
      <ul class="features-list">
        <li *ngFor="let feature of option.features">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M7 10L9 12L13 8M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {{ feature }}
        </li>
      </ul>

      <!-- Current Plan Badge -->
      <div class="current-badge" *ngIf="currentSubscription && currentSubscription.plan === option.plan">
        התוכנית הנוכחית שלך
      </div>
    </div>
  </div>

  <!-- Purchase Button -->
  <div class="purchase-section" *ngIf="selectedPlan !== 0">
    <button
      class="purchase-btn"
      [disabled]="loading || (currentSubscription && currentSubscription.plan === selectedPlan)"
      (click)="purchaseSubscription()">
      <span *ngIf="!loading">
        {{ currentSubscription ? 'שדרג עכשיו' : 'התחל עכשיו' }}
      </span>
      <span *ngIf="loading">טוען...</span>
    </button>

    <p class="trial-notice" *ngIf="!currentSubscription">
      🎁 קבל 2 חודשי ניסיון חינם!
    </p>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="error">
    {{ error }}
  </div>

  <!-- Additional Info -->
  <div class="additional-info">
    <h4>פרופילים נוספים</h4>
    <p>רוצה יותר מ-{{ getSelectedPlanIncludedProfiles() }} פרופיל?</p>
    <p>כל פרופיל נוסף - רק 30₪ לחודש</p>
  </div>
</div>
